<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.1 LangChain简介 | Skeinz&#39;s page</title>
    
<link rel="stylesheet" href="/css/style.css">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          TeX: {
            extensions: ["amsmath.js", "cancel.js"],
          }
        });
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div class="container">
        <header class="post-navbar">
    <a href="/" class="nav-left">
        <img src="/img/avatar.jpg" alt="Avatar" class="nav-avatar">
        <span class="nav-title">上下求索</span>
    </a>

    <div class="nav-right">
        <div class="nav-item search-trigger">
            <img src="/img/icons/search.svg" alt="Search" class="search-icon">
            <span>请输入关键词搜索...</span>
        </div>

        <a href="/notes/" class="nav-link">笔记导航</a>

        <div class="nav-item theme-switcher">
            <img src="/img/icons/sun.svg" alt="Sun" class="sun-icon">
            <img src="/img/icons/moon.svg" alt="Moon" class="moon-icon">
        </div>
    </div>
</header>

<div id="search-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <input type="text" id="search-input" placeholder="输入关键字搜索...">
        <div id="search-results"></div>
    </div>
</div>
<div class="post-layout">
  <aside class="post-sidebar">
    
    
      
      <nav>
          <div class="sidebar-top">
              <!-- <a href="/" class="back-to-home-link" style="display: flex; align-items: center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 18l-6-6l6-6"/></svg>
                  <span>返回首页</span>
              </a> -->
              <h3>大语言模型</h3>
          </div>
          <ul>
              
                  <li class="sidebar-group">
                      <details open>
                          <summary>
                              <svg class="sidebar-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="m15.5 12.001l-5.75 5.75c-.15.15-.325.225-.525.225s-.375-.075-.525-.225c-.3-.3-.3-.775 0-1.075l5.225-5.25l-5.225-5.25c-.3-.3-.3-.775 0-1.075s.775-.3 1.075 0l5.75 5.75c.15.15.225.325.225.525s-.075.375-.225.525Z"/></svg>
                              <span class="sidebar-summary-text">1 强化学习</span>
                          </summary>
                          <div class="details-content">
                              <ul>
                                  
                                      <li class="sidebar-item ">
                                          <a href="/notes/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/1.1-%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E5%85%A5%E9%97%A8/">1.1 Q-Learning</a>
                                      </li>
                                  
                              </ul>
                          </div>
                      </details>
                  </li>
              
                  <li class="sidebar-group">
                      <details open>
                          <summary>
                              <svg class="sidebar-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="m15.5 12.001l-5.75 5.75c-.15.15-.325.225-.525.225s-.375-.075-.525-.225c-.3-.3-.3-.775 0-1.075l5.225-5.25l-5.225-5.25c-.3-.3-.3-.775 0-1.075s.775-.3 1.075 0l5.75 5.75c.15.15.225.325.225.525s-.075.375-.225.525Z"/></svg>
                              <span class="sidebar-summary-text">2 构建一个大模型</span>
                          </summary>
                          <div class="details-content">
                              <ul>
                                  
                                      <li class="sidebar-item ">
                                          <a href="/notes/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/2.1-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%A2%84%E8%AE%AD%E7%BB%83/">1.1 预训练</a>
                                      </li>
                                  
                              </ul>
                          </div>
                      </details>
                  </li>
              
                  <li class="sidebar-group">
                      <details open>
                          <summary>
                              <svg class="sidebar-arrow" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="m15.5 12.001l-5.75 5.75c-.15.15-.325.225-.525.225s-.375-.075-.525-.225c-.3-.3-.3-.775 0-1.075l5.225-5.25l-5.225-5.25c-.3-.3-.3-.775 0-1.075s.775-.3 1.075 0l5.75 5.75c.15.15.225.325.225.525s-.075.375-.225.525Z"/></svg>
                              <span class="sidebar-summary-text">3 应用开发</span>
                          </summary>
                          <div class="details-content">
                              <ul>
                                  
                                      <li class="sidebar-item active">
                                          <a href="/notes/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/3.1-LangChain/">3.1 LangChain简介</a>
                                      </li>
                                  
                                      <li class="sidebar-item ">
                                          <a href="/notes/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/3.2-RAG/">3.2 RAG</a>
                                      </li>
                                  
                                      <li class="sidebar-item ">
                                          <a href="/notes/%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B/3.3-Agent/">3.3 Agent</a>
                                      </li>
                                  
                              </ul>
                          </div>
                      </details>
                  </li>
              
          </ul>
      </nav>
    
  </aside>

  <article class="post-content">
    

    <h1>3.1 LangChain简介</h1>
    <!-- <div class="post-meta">
      
        <time class="post-date-tag" datetime="2025-09-15T16:00:00.000Z">
            发布于: 2025-09-16
        </time>
      
    </div> -->
    <div class="post-body">
        <h1 id="1-简要了解">1 简要了解</h1>
<p>LangChain是由Harvard University的Harrison Chase在2022年10月发起研发的一个开源框架，用于开发由大语言模型驱动的程序，比如智能体、问答系统、对话机器人、文档搜索系统、私有知识库等。</p>
<p>大模型应用开发框架主要有如下几种：</p>
<table>
<thead>
<tr>
<th style="text-align:center">语言</th>
<th style="text-align:center">框架</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Python</td>
<td style="text-align:center">LangChain</td>
<td style="text-align:left">适合复杂任务分解和单智能体，还有Java和js版本</td>
</tr>
<tr>
<td style="text-align:center">Python</td>
<td style="text-align:center">LlamaIndex</td>
<td style="text-align:left">高效检索和索引→RAG</td>
</tr>
<tr>
<td style="text-align:center">Java</td>
<td style="text-align:center">LangChain4J</td>
<td style="text-align:left">包含LangChain的主要核心功能</td>
</tr>
<tr>
<td style="text-align:center">Java</td>
<td style="text-align:center">SpringAI</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">Java</td>
<td style="text-align:center">SpringAI Alibaba</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">C#</td>
<td style="text-align:center">SemanticKernel</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h2 id="1-1-远程大模型调用">1.1 远程大模型调用</h2>
<p>说了半天，还是不懂LangChain是用来干嘛的。接下来，做一个简单的类比：</p>
<p>在Java后端的数据库模块中，JDBC（Java Database Connectivity）是Java语言中用来规范客户端程序如何访问数据库的应用程序接口（API）。各个数据库厂商（Oracle、MySQL、Microsoft等）根据JDBC这套标准协议，去实现具体的“连接驱动”（JDBC Driver），这个驱动负责将标准的JDBC调用“翻译”成该数据库自己能理解的私有协议。</p>
<p>同样的道理，不同大模型厂商的大模型的url、api key传递方式、请求与响应格式、特有功能等等各不相同。下面举一个简单的例子来说明这一点。</p>
<ul>
<li>没有LangChain，直接调用OpenAI的api过程（以OpenAI为例）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> openai<br><br>openai.api_key = <span class="hljs-string">&quot;xxx&quot;</span><br>response = openai.ChatCompletion.create(<br>    model=<span class="hljs-string">&quot;xxx&quot;</span>,<br>    messages=[&#123;<span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;xxx&quot;</span>&#125;],<br>    temperature=<span class="hljs-number">0.7</span><br>)<br><br><span class="hljs-comment"># 特定格式解析</span><br><span class="hljs-built_in">print</span>(response[<span class="hljs-string">&#x27;choices&#x27;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&#x27;message&#x27;</span>][<span class="hljs-string">&#x27;content&#x27;</span>])<br></code></pre></td></tr></table></figure>
<p>如果是千问模型，你还需要单独下载dashscope，然后直接使用千问官方提供的SDK，或者使用HTTP客户端手动构造符合千问API规范的请求。不想再去查了，因此这里采用后者来演示一遍：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> json<br><br>url = <span class="hljs-string">&quot;https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation&quot;</span> <span class="hljs-comment"># 千问独有的URL</span><br>api_key = <span class="hljs-string">&quot;xxx&quot;</span><br>headers = &#123;<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>    <span class="hljs-string">&quot;Authorization&quot;</span>: <span class="hljs-string">f&quot;Bearer <span class="hljs-subst">&#123;api_key&#125;</span>&quot;</span> <span class="hljs-comment"># 千问的认证方式</span><br>&#125;<br><span class="hljs-comment"># 构造千问API要求的特定JSON请求体</span><br>payload = &#123;<br>    <span class="hljs-string">&quot;model&quot;</span>: <span class="hljs-string">&quot;qwen-max&quot;</span>, <span class="hljs-comment"># 千问特定的模型名</span><br>    <span class="hljs-string">&quot;input&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;messages&quot;</span>: [<br>            &#123;<br>                <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br>                <span class="hljs-string">&quot;content&quot;</span>: <span class="hljs-string">&quot;xxx&quot;</span><br>            &#125;<br>        ]<br>    &#125;,<br>    <span class="hljs-string">&quot;parameters&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;result_format&quot;</span>: <span class="hljs-string">&quot;text&quot;</span> <span class="hljs-comment"># 千问特定的参数</span><br>    &#125;<br>&#125;<br><span class="hljs-comment"># 发送请求并处理响应</span><br>response = requests.post(url, headers=headers, data=json.dumps(payload))<br>result = response.json()<br><span class="hljs-comment"># 最后按照千问响应的特定JSON结构提取结果，需要查阅千问的API文档才知道结果在哪条路径下</span><br></code></pre></td></tr></table></figure>
<p>官方给出的例子<a target="_blank" rel="noopener" href="https://help.aliyun.com/zh/model-studio/use-qwen-by-calling-api">通义千问API参考_大模型服务平台百炼(Model Studio)-阿里云帮助中心 (aliyun.com)</a>中，qwen-plus等也可以使用openai包来调用。实际上，OpenAI的官方Python库 （openai包）本身设计为只调用 OpenAI 自家的接口，其他厂商为了降低开发者的学习和迁移成本，选择提供与OpenAI API格式完全兼容的接口。这就意味着它们的API<strong>端点URL结构</strong>、<strong>请求体格式</strong>（JSON字段如<code>model</code>、<code>messages</code>、<code>temperature</code>）、<strong>响应体格式</strong>和<strong>认证方式</strong>（使用<code>Authorization: Bearer &lt;key&gt;</code>头）都刻意设计得与OpenAI一模一样。</p>
<ul>
<li>采用LangChain调用</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> langchain_community.llms <span class="hljs-keyword">import</span> OpenAI  <span class="hljs-comment"># 调用千问则导入Tongyi</span><br><span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> PromptTemplate<br><br>llm = OpenAI(openai_api_key=<span class="hljs-string">&quot;xxx&quot;</span>)<br>prompt = PromptTemplate.from_template(<span class="hljs-string">&quot;你的提示词&quot;</span>)<br><br>chain = prompt | llm <span class="hljs-comment"># 创建一个简单的链</span><br>response = chain.invoke(xxx)  <span class="hljs-comment"># 在这里是字典类型</span><br></code></pre></td></tr></table></figure>
<p><strong>说明</strong>：<code>invoke</code>参数的传递。上面的chain的第一个组件是prompt</p>
<table>
<thead>
<tr>
<th>chain的第一个组件</th>
<th>invoke传参</th>
<th>例子</th>
</tr>
</thead>
<tbody>
<tr>
<td>需要输入变量的 <code>PromptTemplate</code></td>
<td>字典，包含所有模板变量</td>
<td>比如你的提示词设置为<code>&quot;今天天气很&#123;status&#125;&quot;</code>，那么invoke应该传入<code>&#123;&quot;status&quot;: &quot;好&quot;&#125;</code></td>
</tr>
<tr>
<td>不需要变量的提示词</td>
<td>空字典或None</td>
<td><code>chain.invoke(&#123;&#125;)</code></td>
</tr>
<tr>
<td>llm</td>
<td>字符串（直接给模型的提示词）</td>
<td><code>chain.invoke(&quot;xxx&quot;)</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>[!INFO]</p>
<p>注意<code>|</code>是管道符，chain的工作流程是从左到右执行，invoke传参给prompt，prompt返回的结果传递给llm使用。</p>
</blockquote>
<p>以上是纯写代码的方式开发应用。除此之外，我们还可以通过第三方大模型应用平台，如Dify、RAG Flow、DB-GPT、MaxKB等，构建大模型应用。</p>
<h2 id="1-2-本地大模型部署">1.2 本地大模型部署</h2>
<p>几乎所有的本地模型部署方案（绝大多数本地大模型推理框架如Ollama、vLLM，<strong>都默认提供与OpenAI API兼容的端点</strong>）都会提供一个标准的API服务器，直接调用本地机器或内网服务器上的一个地址即可。使用LangChain调用这个url时，导入OpenAI类，api_key字段留空就行。</p>
<p>当然，如果你只是想测试一下大模型、自己玩，只需要使用Hugging Face Transformers推理引擎。</p>

    </div>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const codeBlocks = document.querySelectorAll('figure.highlight');
    
        codeBlocks.forEach(block => {
            // 1. 获取语言标签
            const lang = block.classList.contains('highlight') ? 
                         block.classList[1] : '';
    
            // 2. 创建一个容器来包裹语言标签和复制按钮
            const toolbar = document.createElement('div');
            toolbar.className = 'highlight-toolbar';
    
            // 3. 创建语言标签
            if (lang) {
                const langLabel = document.createElement('span');
                langLabel.className = 'highlight-lang';
                langLabel.textContent = lang.toUpperCase();
                toolbar.appendChild(langLabel);
            }
    
            // 4. 创建复制按钮
            const copyButton = document.createElement('button');
            copyButton.className = 'highlight-copy-btn';
            copyButton.textContent = '复制';
            
            copyButton.addEventListener('click', () => {
                // 优先选择 .code 元素（针对有行号的表格），如果没有则选择 pre 元素
                const codeElement = block.querySelector('.code') || block.querySelector('pre');
                if (codeElement) {
                    navigator.clipboard.writeText(codeElement.textContent).then(() => {
                        copyButton.textContent = '已复制!';
                        setTimeout(() => {
                            copyButton.textContent = '复制';
                        }, 2000);
                    }).catch(err => {
                        console.error('复制失败: ', err);
                    });
                }
            });
            toolbar.appendChild(copyButton);
    
            // 5. 将工具栏插入到代码块中
            block.appendChild(toolbar);
        });
    });
</script>
  </article>
</div>

    </div>
    
<script src="/js/script.js"></script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>